<!DOCTYPE html>
<!-- To do: add grid@@@@@@@@@@@!!!!!!!!!!!!!!!!! -->
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>

    body {
      font: 10px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      stroke-width: 1;
      shape-rendering: crispEdges;
      opacity:0.3;

    }


    .y.axis line{
      stroke:#777;
      stroke-dasharray:2,2;
      opacity: 0.3;
    }


    .line {
      fill: none;
      stroke-width: 3px;
      stroke-opacity:.75;

    }

    .legend {
      fill: black;
      display: block;
    }

    line.horizonalGrid{
      fill : none;
      shape-rendering : crispEdges;
      stroke : black;
      stroke-width : 1.5px;
      } 

    </style>
</head>
<body>

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript">

    var margin = {top:50, right:0, bottom:70, left:70},
        width  = 300 + margin.left + margin.right,
        height = 200 + margin.top + margin.bottom,
        legendWidth = 200;

    var parseDate = d3.time.format("%Y").parse;

    var x = d3.time.scale()
        .range([0, width]);

    var y = d3.scale.linear()
        .range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .tickSize(width, 0) // set outer to 0 to avoid ticks on the border
        .orient("right");

    var setColor = d3.scale.ordinal()
    .domain(["foo", "bar", "baz"])
    .range(['#fef0d9',"#fc8d59",'#b30000']);;

    var line = d3.svg.line()
        .interpolate("basis")
        .x(function(d) { return x(d.year); })
        .y(function(d) { return y(d.rate); });


    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right + legendWidth)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

    d3.csv("country_medianunemploymentrate.csv", function(error, data) {
      var countries = {}
      data.forEach(function(d) {
        if (d.geography && d.year) {
          d.year = parseDate(d.year);
          d.rate = +d.rate;
          if (d.geography in countries) {
            countries[d.geography].push({
              year: d.year,
              rate: d.rate
            });
          } else {
            countries[d.geography] = []
          }
        }
      });

      var countryData = []
      for (geography in countries) {
        countryData.push({
          name: geography,
          values: countries[geography]
        });
      }

      x.domain(d3.extent(data, function(d) { return d.year; }));
      y.domain([
          d3.min(countryData, function(c) { return d3.min(c.values, function(v) { return v.rate; }); }),
          d3.max(countryData, function(c) { return d3.max(c.values, function(v) { return v.rate; }); })
      ])
      
      var gx = svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      var gy = svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
          .call(customAxis)
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Unemployment Rate (%)")
          .attr("transform", "rotate(-90),translate(-10,-30)");      


      var country = svg.selectAll(".geography")
          .data(countryData)
          .enter()
          .append("g")
          .attr("class", "geography");


      country.append("path")
          .attr("class", "line")
          .attr("stroke", function(d, i){
            return setColor(i);
          })
          .attr("d", function(d) { 
              return line(d.values);
          });

      country.append("text")
          .datum(function(d) { return {name: d.name, value: d.values[d.values.length-1]}; })
          .attr("transform", function(d) { 
              return "translate(" + x(d.value.year) + "," + y(d.value.rate) + ")";
          })
          .attr("x", "4")
          .attr("dy", ".35em")
          .attr('class', 'legend')
          .text(function(d) { return d.name; });

      // /* Add 'curtain' rectangle to hide entire graph */
      // var curtain = svg.append('rect')
      //   .attr('x', -1 * width)
      //   .attr('y', -1 * height)
      //   .attr('height', height)
      //   .attr('width', width)
      //   .attr('class', 'curtain')
      //   .attr('transform', 'rotate(180)')
      //   .style('fill', '#ffffff')

      // /* Optionally add a guideline */
      // var guideline = svg.append('line')
      //   .attr('stroke', '#333')
      //   .attr('stroke-width',0)
      //   .attr('class', 'guide')
      //   .attr('x1', 1)
      //   .attr('y1', 1)
      //   .attr('x2', 1)
      //   .attr('y2', height)

      /* Create a shared transition for anything we're animating */
      setTimeout(function(){
        y.domain([0,3e6]);
        gy.call(customAxis);
        }, 1000);

        function customAxis(g) {
          g.selectAll("text")
              .attr("x", 4)
              .attr("dy", -4);
        }


      var t = svg.transition()
        .delay(750)
        .duration(6000)
        .ease('linear')
        .each('end', function() {
          d3.select('line.guide')
            .transition()
            .style('opacity', 0)
            .remove()
        });

      // t.select('rect.curtain')
      //   .attr('width', 0);
      // t.select('line.guide')
      //   .attr('transform', 'translate(' + width + ', 0)')

      // d3.select("#show_guideline").on("change", function(e) {
      //   guideline.attr('stroke-width', this.checked ? 1 : 0);
      //   curtain.attr("opacity", this.checked ? 0.75 : 1);
      // })


});



/* create grid*/
//Draw a grid



    </script>
</body>
</html>